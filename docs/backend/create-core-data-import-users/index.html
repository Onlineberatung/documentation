<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Create core data and import users · Caritas Online-Beratung</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## AgencyService: Stammdaten anlegen"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Create core data and import users · Caritas Online-Beratung"/><meta property="og:type" content="website"/><meta property="og:url" content="https://caritasdeutschland.github.io/documentation/"/><meta property="og:description" content="## AgencyService: Stammdaten anlegen"/><meta property="og:image" content="https://caritasdeutschland.github.io/documentation/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://caritasdeutschland.github.io/documentation/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/documentation/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/documentation/js/scrollSpy.js"></script><link rel="stylesheet" href="/documentation/css/main.css"/><script src="/documentation/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/documentation/"><img class="logo" src="/documentation/img/caritas_logo.svg" alt="Caritas Online-Beratung"/><h2 class="headerTitleWithLogo">Caritas Online-Beratung</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/documentation/docs/general/home" target="_self">Docs</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Backend</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">General</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/general/home">Home</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/general/git-workflow">Git workflow</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/general/browser-matrix">Browser matrix</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Project Setup</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/setup/setup-backend">Setting up the backend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/setup/setup-frontend">Setting up the frontend</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Backend</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/install-and-running-on-server">Installing and running the backend on the server</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/install-and-running-locally">Installing and running the backend for local development</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/first-start">First start</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/service-configuration">Service configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/starting-and-stopping-the-services">Starting and stopping the services</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/login-data-access-links">Login data and access links</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/file-permissions">File permissions</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/build-and-load-docker-image">Docker Image lokal bauen und in Docker laden</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/openldap-configuration">OpenLDAP konfigurieren</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/documentation/docs/backend/create-core-data-import-users">Create core data and import users</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/liquibase">Database versioning with liquibase</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/mailservice-templates">Mail templates</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/jenkins">Einrichten des Build-Prozesses über Jenkins</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/nginx">NGINX configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/ssl-certificate">SSL certificate</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/cors-configuration">CORS configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/video-backend">Installing and running the videoBackend</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Frontend</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/build">Build</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/tools-and-technologies">Tools and Technologies</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/testing">Testing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Releases</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/versionhistory">Version History</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/agencyservice">AgencyService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/frontend">Frontend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/liveservice">LiveService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mailservice">MailService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/messageservice">MessageService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/nginx">NGINX</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/uploadservice">UploadService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/userservice">UserService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/videoservice">VideoService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/adminer">3rd party - Adminer</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/keycloak">3rd party - Keycloak</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mariadb">3rd party - MariaDB</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mongodb">3rd party - MongoDB</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/nosqlclient">3rd party -  Nosqlclient</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/openldap">3rd party - OpenLDAP</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/rocketchat">3rd party - Rocket.Chat</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/backend">Backend stack - Backend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/videobackend">Backend stack - VideoBackend</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Create core data and import users</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="agencyservice-stammdaten-anlegen"></a><a href="#agencyservice-stammdaten-anlegen" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AgencyService: Stammdaten anlegen</h2>
<p>Für den AgencyService müssen Stammdaten (Beratungsstellen, etc.) angelegt werden. Hierzu können beispielhaft folgende SQL-Statements im Adminer ausgeführt werden (Reihenfolge beachten):</p>
<h3><a class="anchor" aria-hidden="true" id="create-dioceses"></a><a href="#create-dioceses" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create dioceses</h3>
<p><code>use agencyservice;</code><br>
<code>INSERT INTO agencyservice.diocese (id, name, create_date, update_date) values (NEXTVAL(sequence_diocese), `&lt;dioceseName&gt;`, now(), now());</code>\</p>
<h3><a class="anchor" aria-hidden="true" id="create-agencies"></a><a href="#create-agencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create agencies</h3>
<p><code>use agencyservice;</code><br>
<code>INSERT INTO `agency` (`id`, `diocese_id`, `name`, `description`, `postcode`, `city`, `is_team_agency`, `consulting_type`, `is_offline`, `create_date`, `update_date`) VALUES</code><br>
<code>(NEXTVAL(sequence_agencies), 1, '&lt;agencyName&gt;', '&lt;agencyDescription&gt;', '&lt;postcode&gt;', '&lt;city&gt;', &lt;isTeamAgency&gt;, &lt;consultingType&gt;, &lt;isOffline&gt;, now(), now());</code>\</p>
<h2><a class="anchor" aria-hidden="true" id="userservice-berater-import"></a><a href="#userservice-berater-import" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UserService: Berater-Import</h2>
<p>Über den UserService können Berater importiert werden. Es können Berater komplett neu angelegt werden oder bestehenden Beratern weitere Beratungsstellen zugewiesen werden. Der Import ist derzeit nicht dafür ausgelegt weitere Daten bei bestehenden Beratern zu ändern.</p>
<p>Beim Import werden die entsprechenden Accounts in Keycloak, in Rocket.Chat und in der Applikations-Datenbank angelegt. Außerdem werden den Beratern die  angegeben Beratungsstellen zugewiesen und die Berater bei vorhandenen Erstanfragen den notwendigen Rocket.Chat-Räumen hinzugefügt.</p>
<p>Der Import erfolgt über eine CSV-Datei mit folgendendem Format (<strong>Die Headlines müssen für den Import entfernt werden</strong>):</p>
<h3><a class="anchor" aria-hidden="true" id="beispiel-import-neuanlage"></a><a href="#beispiel-import-neuanlage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Beispiel Import (Neuanlage)</h3>
<pre><code class="hljs">consultant<span class="hljs-number">_</span>id,old<span class="hljs-number">_</span>id,username,first<span class="hljs-number">_n</span>ame,last<span class="hljs-number">_n</span>ame,email,<span class="hljs-keyword">is</span><span class="hljs-number">_</span>absent,absence<span class="hljs-number">_m</span>essage,<span class="hljs-string">"agency_id;roleset,agency_id;roleset"</span>
,<span class="hljs-number">1</span>,mueller,Max,Müller,max.meuller<span class="hljs-meta">@domain</span>.de,nein,<span class="hljs-string">""</span>,<span class="hljs-string">"300;main,301;main"</span>
,<span class="hljs-number">2</span>,meier,Werner,meier,werner.meier<span class="hljs-meta">@domain</span>.de,ja,<span class="hljs-string">"Ich bin zur Zeit nicht erreichbar."</span>,<span class="hljs-string">"300;main"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="beispiel-update"></a><a href="#beispiel-update" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Beispiel Update</h3>
<pre><code class="hljs"><span class="hljs-built_in">consultant_id,</span>old_id,username,first_name,last_name,email,is_absent,absence_message,<span class="hljs-string">"agency_id;roleset,agency_id;roleset"</span>
KSJDD88-<span class="hljs-number">0339393</span>-<span class="hljs-number">9999</span>DDD,,mueller,,max.meuller@domain.de,,,,,<span class="hljs-string">"304;main,305;main"</span>
</code></pre>
<p><strong>Hinweis</strong>: Bei einem Update werden derzeit nur die genannten Beratungsstellen zugewiesen. Es findet kein Update beim Benutzernamen oder der E-Mail-Adresse statt.</p>
<h3><a class="anchor" aria-hidden="true" id="beschreibung-der-felder"></a><a href="#beschreibung-der-felder" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Beschreibung der Felder</h3>
<table>
<thead>
<tr><th>Feld</th><th>Beschreibung</th></tr>
</thead>
<tbody>
<tr><td>consultant_id</td><td>Keycloak-ID</td></tr>
<tr><td>id_old</td><td>ID aus der alten Beratungsplattform</td></tr>
<tr><td>username</td><td>Benutzername</td></tr>
<tr><td>first_name</td><td>Vorname</td></tr>
<tr><td>last_name</td><td>Nachname</td></tr>
<tr><td>email</td><td>E-Mail-Adresse</td></tr>
<tr><td>is_absent</td><td>Gibt an, ob ein Berater auf abwesend gesetzt werden soll. Zulässige Werte: ja/nein</td></tr>
<tr><td>absence_message</td><td>Abwesenheitsnotiz</td></tr>
<tr><td>agency_rolesets</td><td>Beratungstellen-ID;Rolle in der Beratungsstelle (kann den consulting type settings im Service entnommen werden). Mehrere Beratungsstellen können komma-separiert angegeben werden</td></tr>
</tbody>
</table>
<p>Der Name und Speicherort der CSV-Datei wird in den <em>application.properties</em> über die <code>consultant.import.filename</code> festgelegt.</p>
<p>Der Import der Berater kann durch einen Aufruf des Endpoints <strong>/users/consultants/import</strong> beim UserService (z.B. mit Postman) erfolgen. Hierbei ist zu beachten, dass ein gültiger Keycloak-Token eines technischen Benutzers mit der Rolle <em>&quot;technical&quot;</em> zu übergeben ist. Der Aufruf ist 1x pro Minute möglich.</p>
<h3><a class="anchor" aria-hidden="true" id="import-protokoll"></a><a href="#import-protokoll" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Import-Protokoll</h3>
<p>Während des Imports wird ein Protokoll in eine Datei geschrieben. Diese Datei liegt auch im Root-Verzeichnis des UserService und hat den Namem
&quot;consultants-import.txt&quot;. Zusätzlich wird ein Timestamp angehängt, damit die Datei bei mehreren Durchläufen nicht überschrieben wird.</p>
<p>Die Datei enthält alle notwendigen Daten um z.B. E-Mails an die Berater zu generieren:</p>
<ul>
<li>Vorname</li>
<li>Nachname</li>
<li>E-Mail-Adresse</li>
<li>Benutzername</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="userservice-ratsuchenden-import-mit-beratung"></a><a href="#userservice-ratsuchenden-import-mit-beratung" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UserService: Ratsuchenden-Import mit Beratung</h2>
<p>Über den UserService können Ratsuchende mit Beratungen importiert werden. Beim Import werden die entsprechenden Accounts in Keycloak, in Rocket.Chat und in der Applikations-Datenbank angelegt. Darüber hinaus wird eine initiale Beratung mit Willkommensnachricht angelegt. Die Beratung wird der angegeben Beratungsstelle und dem angegeben Berater zugeordnet.</p>
<p>Der Import erfolgt über eine CSV-Datei mit folgendendem Format (<strong>Die Headlines müssen für den Import entfernt werden</strong>):</p>
<pre><code class="hljs">id_old,username,email,consultant_id,postcode,agency_id,pw
<span class="hljs-number">219344</span>,helpseeker,<span class="hljs-symbol">asker@</span>problem.com,fc68b24e-bc0f<span class="hljs-number">-4</span>cb5-a215<span class="hljs-number">-7</span>bef0d79ee2d,<span class="hljs-number">53111</span>,<span class="hljs-number">168</span>,jjuasd8§$jk!
,helpseeker2,<span class="hljs-symbol">asker2@</span>problem.com,fc68b24e-bc0f<span class="hljs-number">-4</span>cb5-a215<span class="hljs-number">-7</span>bef0d79ee2d,<span class="hljs-number">53111</span>,<span class="hljs-number">168</span>,
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="beschreibung-der-felder-1"></a><a href="#beschreibung-der-felder-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Beschreibung der Felder</h3>
<table>
<thead>
<tr><th>Feld</th><th>Beschreibung</th></tr>
</thead>
<tbody>
<tr><td>id_old</td><td>ID aus der alten Beratungsplattform</td></tr>
<tr><td>username</td><td>Benutzername</td></tr>
<tr><td>email</td><td>E-Mail-Adresse</td></tr>
<tr><td>consultant_id</td><td>Keycloak-ID des Beraters, der zugewiesen werden soll</td></tr>
<tr><td>postcode</td><td>Postleitzahl, die bei der Beratung hinterlegt werden soll (kommt normalerweise aus der Registrierung)</td></tr>
<tr><td>agency_id</td><td>ID dee Beratungstelle, die zugewiesen werden soll</td></tr>
<tr><td>pw</td><td>Passwort (optional). Wird kein Passwort angegeben wird ein generiertes vergeben.</td></tr>
</tbody>
</table>
<p>Der Name und Speicherort der CSV-Datei wird in den <em>application.properties</em> über die <code>asker.import.filename</code> festgelegt.</p>
<p>Das Willkommens-Standard-Systemnachrichten-File wird ebenfalls in der <em>application.properties</em> angegeben. Dabei wird der Consulting Type PLatzhalter mit der jeweiligen ID des Resorts ersetzt. Die Dateien müssen im selben Verzeichnis wie das Import-File liegen. Hier gilt es zu beachten, dass diese Textdatei die selbe Kodierung, wie im Import angegeben, besitzt (momentan: UTF-8).</p>
<p>Der Import der Ratsuchenden mit Beratung kann durch einen Aufruf des Endpoints <strong>/users/askers/import</strong> beim UserService (z.B. mit Postman) erfolgen. Hierbei ist zu beachten, dass ein gültiger Keycloak-Token eines technischen Benutzers mit der Rolle &quot;technical&quot; zu übergeben ist.</p>
<h3><a class="anchor" aria-hidden="true" id="import-protokoll-1"></a><a href="#import-protokoll-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Import-Protokoll</h3>
<p>Während des Imports wird ein Protokoll in eine Datei geschrieben (Name und Pfad wie in der <em>application.properties</em> angegeben). Zusätzlich wird ein Timestamp angehängt, damit die Datei bei mehreren Durchläufen nicht überschrieben wird.</p>
<h2><a class="anchor" aria-hidden="true" id="userservice-ratsuchenden-import-ohne-beratung"></a><a href="#userservice-ratsuchenden-import-ohne-beratung" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UserService: Ratsuchenden-Import ohne Beratung</h2>
<p>Über den UserService können Ratsuchende ohne Beratungen importiert werden. Beim Import werden die entsprechenden Accounts in Keycloak, in Rocket.Chat und in der Applikations-Datenbank angelegt und die Verknüpfung zur Beratungsstelle hergestellt.</p>
<p>Der Import erfolgt über eine CSV-Datei mit folgendendem Format (<strong>Die Headlines müssen für den Import entfernt werden</strong>):</p>
<pre><code class="hljs">id_old,username,email,agency_id,pw
,asker1,<span class="hljs-symbol">asker1@</span>domain.de,<span class="hljs-number">1332</span>,
<span class="hljs-number">1234</span>,asker2,<span class="hljs-symbol">asker2@</span>domain.de,<span class="hljs-number">1555</span>,
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="beschreibung-der-felder-2"></a><a href="#beschreibung-der-felder-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Beschreibung der Felder</h3>
<table>
<thead>
<tr><th>Feld</th><th>Beschreibung</th></tr>
</thead>
<tbody>
<tr><td>id_old</td><td>ID aus der alten Beratungsplattform</td></tr>
<tr><td>username</td><td>Benutzername</td></tr>
<tr><td>email</td><td>E-Mail-Adresse</td></tr>
<tr><td>agency_id</td><td>ID dee Beratungstelle, die zugewiesen werden soll</td></tr>
<tr><td>pw</td><td>Passwort (optional). Wird kein Passwort angegeben wird ein generiertes vergeben.</td></tr>
</tbody>
</table>
<p>Der Name und Speicherort der CSV-Datei wird in den <em>application.properties</em> über die <code>asker.import.withoutsession.filename</code> festgelegt.</p>
<p>Der Import der Ratsuchenden mit Beratung kann durch einen Aufruf des Endpoints <strong>/users/askersWithoutSession/import</strong> beim UserService (z.B. mit Postman) erfolgen. Hierbei ist zu beachten, dass ein gültiger Keycloak-Token eines technischen Benutzers mit der Rolle &quot;technical&quot; zu übergeben ist.</p>
<h3><a class="anchor" aria-hidden="true" id="import-protokoll-2"></a><a href="#import-protokoll-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Import-Protokoll</h3>
<p>Während des Imports wird ein Protokoll in eine Datei geschrieben (Name und Pfad wie in der <em>application.properties</em> angegeben). Zusätzlich wird ein Timestamp angehängt, damit die Datei bei mehreren Durchläufen nicht überschrieben wird.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/documentation/docs/backend/openldap-configuration"><span class="arrow-prev">← </span><span class="function-name-prevnext">OpenLDAP konfigurieren</span></a><a class="docs-next button" href="/documentation/docs/backend/liquibase"><span>Database versioning with liquibase</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#agencyservice-stammdaten-anlegen">AgencyService: Stammdaten anlegen</a><ul class="toc-headings"><li><a href="#create-dioceses">Create dioceses</a></li><li><a href="#create-agencies">Create agencies</a></li></ul></li><li><a href="#userservice-berater-import">UserService: Berater-Import</a><ul class="toc-headings"><li><a href="#beispiel-import-neuanlage">Beispiel Import (Neuanlage)</a></li><li><a href="#beispiel-update">Beispiel Update</a></li><li><a href="#beschreibung-der-felder">Beschreibung der Felder</a></li><li><a href="#import-protokoll">Import-Protokoll</a></li></ul></li><li><a href="#userservice-ratsuchenden-import-mit-beratung">UserService: Ratsuchenden-Import mit Beratung</a><ul class="toc-headings"><li><a href="#beschreibung-der-felder-1">Beschreibung der Felder</a></li><li><a href="#import-protokoll-1">Import-Protokoll</a></li></ul></li><li><a href="#userservice-ratsuchenden-import-ohne-beratung">UserService: Ratsuchenden-Import ohne Beratung</a><ul class="toc-headings"><li><a href="#beschreibung-der-felder-2">Beschreibung der Felder</a></li><li><a href="#import-protokoll-2">Import-Protokoll</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/documentation/" class="nav-home"><img src="/documentation/img/caritas_logo.svg" alt="Caritas Online-Beratung" width="66" height="58"/></a><div><h5>Docs</h5><a href="/documentation/docs/general/home.html">Home</a><a href="/documentation/docs/setup/setup-backend.html">Setting up Backend</a><a href="/documentation/docs/setup/setup-frontend.html">Setting up Frontend</a></div><div><h5>More</h5><a href="https://github.com/CaritasDeutschland">GitHub</a></div></section><section class="copyright">Copyright © 2021 Caritas Deutschland</section></footer></div></body></html>