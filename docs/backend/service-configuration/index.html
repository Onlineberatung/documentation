<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Service configuration · Caritas Online-Beratung</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Some components require an initial setup."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Service configuration · Caritas Online-Beratung"/><meta property="og:type" content="website"/><meta property="og:url" content="https://caritasdeutschland.github.io/documentation/"/><meta property="og:description" content="Some components require an initial setup."/><meta property="og:image" content="https://caritasdeutschland.github.io/documentation/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://caritasdeutschland.github.io/documentation/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/documentation/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/documentation/js/scrollSpy.js"></script><link rel="stylesheet" href="/documentation/css/main.css"/><script src="/documentation/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/documentation/"><img class="logo" src="/documentation/img/caritas_logo.svg" alt="Caritas Online-Beratung"/><h2 class="headerTitleWithLogo">Caritas Online-Beratung</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/documentation/docs/general/home" target="_self">Docs</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Backend setup and configuration</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">General</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/general/home">Home</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/general/git-workflow">Git workflow</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Project setup</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/setup/setup-backend">Setting up the backend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/setup/setup-frontend">Setting up the frontend</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Backend setup and configuration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/install-and-running-on-server">Installing and running the backend on the server</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/install-and-running-locally">Installing and running the backend for local development</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/first-start">First start</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/documentation/docs/backend/service-configuration">Service configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/file-permissions">File permissions</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/openldap-configuration">Configure OpenLDAP</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/create-core-data-import-users">Create core data and import users</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/mailservice-templates">Mail templates</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/jenkins">Setting up the build process via Jenkins</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/nginx">NGINX configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/ssl-certificate">SSL certificate</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/cors-configuration">CORS configuration</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/video-backend">Installing and running the videoBackend</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Backend in general</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/service-overview">Service overview</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/starting-and-stopping-the-services">Starting and stopping the services</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/login-data-access-links">Login data and access links</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/admin-api">Admin API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Backend development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/build-and-load-docker-image">Build Docker image locally and load it into Docker</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/backend/liquibase">Database versioning with liquibase</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Frontend</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/build">Build</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/tools-and-technologies">Tools and Technologies</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/frontend/testing">Testing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Quality Assurance</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/quality-assurance/browser-matrix">Browser matrix</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/quality-assurance/test-cases">Testcases</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/quality-assurance/smoke-testsuite">Smoke Test Suite</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Releases</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/versionhistory">Version History</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Releases of own services</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/agencyservice">AgencyService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/backend">Backend stack - Backend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/consultingtypeservice">ConsultingTypeService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/frontend">Frontend</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/liveservice">LiveService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mailservice">MailService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/messageservice">MessageService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/uploadservice">UploadService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/userservice">UserService</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/videoservice">VideoService</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Releases of 3rd party components</h3><ul class=""><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/adminer">3rd party - Adminer</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/keycloak">3rd party - Keycloak</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mariadb">3rd party - MariaDB</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/mongodb">3rd party - MongoDB</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/nginx">NGINX</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/nosqlclient">3rd party -  Nosqlclient</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/openldap">3rd party - OpenLDAP</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/rocketchat">3rd party - Rocket.Chat</a></li><li class="navListItem"><a class="navItem" href="/documentation/docs/releases/videobackend">Backend stack - VideoBackend</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Service configuration</h1></header><article><div><span><p>Some components require an initial setup.
These are listed here.</p>
<h2><a class="anchor" aria-hidden="true" id="rocketchat"></a><a href="#rocketchat" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rocket.Chat</h2>
<p>When logging in for the first time, the administrator account must be set up.
Simply follow the steps in the wizard (http://<code>&lt;HOST&gt;</code>:3000).
At step 3 &quot;Server information&quot; the option <code>Auto opt in new users for Two Factor via Email</code> should be set to <code>No</code>.
As type (Step 4 &quot;Register Server&quot;) a local installation (standalone) is selected.</p>
<p><strong>Further configuration steps:</strong></p>
<h3><a class="anchor" aria-hidden="true" id="configure-ldap"></a><a href="#configure-ldap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure LDAP:</h3>
<p>Rocket.Chat still needs to be connected to LDAP - to do this, apply the following settings in the administration area, menu item <em>LDAP</em> (all options not listed should not be changed or left at default values):</p>
<table>
<thead>
<tr><th>Field</th><th>Value</th><th>Comment</th></tr>
</thead>
<tbody>
<tr><td><strong>Basic Settings</strong></td><td></td><td></td></tr>
<tr><td>Enable</td><td>True</td><td></td></tr>
<tr><td>Login Fallback</td><td>True</td><td>Important, because otherwise the initial admin cannot log in anymore, because it is not available in LDAP.</td></tr>
<tr><td>Find user after login</td><td>False</td><td></td></tr>
<tr><td>Host</td><td>openldap</td><td></td></tr>
<tr><td>Port</td><td>389</td><td></td></tr>
<tr><td>Reconnect</td><td>True</td><td></td></tr>
<tr><td>CA Cert</td><td></td><td></td></tr>
<tr><td>Base DN</td><td>ou=users,ou=ob,dc=onlineberatung,dc=de</td><td></td></tr>
<tr><td>Internal Log Level</td><td>INFO</td><td></td></tr>
<tr><td>**Authentication **</td><td></td><td></td></tr>
<tr><td>Enable</td><td>True</td><td></td></tr>
<tr><td>User DN</td><td>cn=admin,dc=onlineberatung,dc=de</td><td></td></tr>
<tr><td>Password</td><td><PASSWORT></td><td>→ Standard-PW: admin</td></tr>
<tr><td><strong>Sync / Import</strong></td><td></td><td></td></tr>
<tr><td>Username Field</td><td>uid</td><td></td></tr>
<tr><td>Unique Identifier Field</td><td>objectGUID,ibm-entryUUID,GUID,dominoUNID,nsuniqueId,uidNumber</td><td></td></tr>
<tr><td>Merge Existing Users</td><td>True</td><td></td></tr>
<tr><td>Sync User Data</td><td>False</td><td>Set this option to <em>true</em> only if the user data of Keycloak and Rocket.Chat are 100% synchronized (especially e-mail address). Otherwise, this can lead to malfunction during password reset process and users won't be able to log in to Rocket.Chat.</td></tr>
<tr><td>Sync User Avatar</td><td>False</td><td></td></tr>
<tr><td><strong>User Search</strong></td><td></td><td></td></tr>
<tr><td>Search Field</td><td>uid,mail</td><td></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="create-technical-user"></a><a href="#create-technical-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create technical user</h3>
<p>The Rocket.Chat technical user is used for every Rocket.Chat action that involves administrative tasks on groups or users. This ensures that a normal user account's permissions can be limited at the greatest possible level.</p>
<ol>
<li>create role/set permissions</li>
</ol>
<ul>
<li>Create the role <em>&quot;technical&quot;</em> with scope <em>&quot;Global&quot;</em> under <em>&quot;Permissions&quot;</em> using the button <em>&quot;+&quot;</em>. If the role does not appear in the list, the page must be reloaded manually (F5).</li>
<li>Add the following rights to the role (check the box):
<ul>
<li><code>Add User to Any Private Channel</code></li>
<li><code>Bypass rate limit for REST API</code></li>
<li><code>Clean Channel History</code></li>
<li><code>Delete Private Channels</code></li>
<li><code>Delete User</code></li>
<li><code>Edit Other User Information</code></li>
<li><code>Remove User</code></li>
<li><code>View Other User Channels</code></li>
<li><code>View Room Administration</code></li>
<li><code>View Direct Messages</code></li>
</ul></li>
</ul>
<ol start="2">
<li>Create User</li>
</ol>
<ul>
<li>Under <em>&quot;Users&quot;</em> create a new user <em>&quot;rocket-chat-technical-user&quot;</em> and assign the previous created
role <em>&quot;technical&quot;</em>. ⚠ This user needs to have the exact username
<em>&quot;rocket-chat-technical-user&quot;</em>, as it´s used for websocket event filtering.</li>
<li><strong>Other settings of the technical user:</strong>
<ul>
<li>Verified = yes</li>
<li>Require password change = no</li>
<li>Join default channels = Not selected</li>
<li>Send welcome email = Not selected</li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="create-system-messages-user"></a><a href="#create-system-messages-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create system messages user</h3>
<p>The Rocket.Chat system messages user is used to write system messages to Rocket.Chat groups. These different message types are defined in the MessageService.</p>
<ol>
<li>create role/set permissions</li>
</ol>
<ul>
<li>Create the role <em>&quot;system&quot;</em> with scope <em>&quot;Global&quot;</em> under <em>&quot;Permissions&quot;</em> using the button <em>&quot;+&quot;</em>. If the role does not appear in the list, the page must be reloaded manually (F5).</li>
<li>Now assign the following permissions to this role:
<ul>
<li><code>Bypass rate limit for REST API</code></li>
<li><code>Create Private Channels</code></li>
<li><code>Edit Room</code></li>
<li><code>View Room Administration</code></li>
</ul></li>
</ul>
<ol start="2">
<li>create user
*Under <em>&quot;Users&quot;</em> create a new user <em>&quot;system&quot;</em> and assign the roles <em>&quot;user&quot;</em> and <em>&quot;system&quot;</em>.</li>
</ol>
<ul>
<li><strong>Additional settings of the system user:</strong>
<ul>
<li>Verified = yes</li>
<li>Require password change = no</li>
<li>Join default channels = Not selected</li>
<li>Send welcome email = Not selected</li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="delete-bot-user"></a><a href="#delete-bot-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete Bot-User</h3>
<p>Under <em>&quot;Users&quot;</em> the BOT (Rocket Cat) must be deleted.</p>
<h3><a class="anchor" aria-hidden="true" id="configure-read-status"></a><a href="#configure-read-status" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure read status</h3>
<p>To ensure that the read status for messages is tracked correctly by Rocket.Chat, the following setting must be set under <em>&quot;Administration&quot;</em> → <em>&quot;General</em>&quot; → <em>&quot;Unread Count</em>&quot;: <em>&quot;All Messages</em>&quot;</p>
<h3><a class="anchor" aria-hidden="true" id="configure-file-upload"></a><a href="#configure-file-upload" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configure file upload</h3>
<p>The file system is preferred for file uploads. The upload folder can then be kept outside the Docker container via a volume.
To do this, the configuration must be adapted under <em>&quot;Administration&quot;</em> → <em>&quot;File Upload&quot;</em> as follows:</p>
<table>
<thead>
<tr><th>Field</th><th>Value</th><th>Comment</th></tr>
</thead>
<tbody>
<tr><td>File Uploads Enabled</td><td>True</td><td></td></tr>
<tr><td>Maximum File Upload Size (in bytes)</td><td>5242880</td><td>5MB</td></tr>
<tr><td>Accepted Media Types</td><td>image/jpeg,image/png,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</td><td>jpg, png, pdf, docx, xlsx</td></tr>
<tr><td>Protect Uploaded Files</td><td>True</td><td></td></tr>
<tr><td>Rotate images on upload</td><td>False</td><td></td></tr>
<tr><td>Enable Json Web Tokens protection to file uploads</td><td>False</td><td></td></tr>
<tr><td>Storage Type</td><td>FileSystem</td><td></td></tr>
<tr><td>File Uploads Enabled in Direct Messages</td><td>True</td><td></td></tr>
<tr><td>File System</td><td></td><td></td></tr>
<tr><td>System Path</td><td>/app/user_uploads</td><td>This directory is mounted on the host system so that the uploaded files are not in the container. Since Rocket.Chat stores them as its own RocketChat user with UID 99999, the owner of the directory on the host system is set to UID 99999. This user does not exist on Linux, but this can be used to restrict the permissions for the directory. Owner: 99999 Group: docker Permissions: 744</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="rate-limiter"></a><a href="#rate-limiter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rate Limiter</h3>
<p>For local development both <code>Rate Limiter</code> can be deactivated.</p>
<p>⚠️Please be sure to enable rate limiting for production and balance the settings according to the ones within NGINX ⚠️</p>
<h3><a class="anchor" aria-hidden="true" id="general"></a><a href="#general" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>General</h3>
<p>Disable <code>UTF8 Names Slugify</code> under <code>UTF8</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="accounts"></a><a href="#accounts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Accounts</h3>
<p>Under <code>Registration</code> disable the following entries:</p>
<ul>
<li><code>Send email to user when user is activated</code></li>
<li><code>Send email to user when user is deactivated</code></li>
<li><code>Verify Email for External Accounts</code></li>
<li><code>Use Default Blocked Domains List</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="keycloak"></a><a href="#keycloak" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keycloak</h2>
<h3><a class="anchor" aria-hidden="true" id="realm"></a><a href="#realm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Realm</h3>
<p>The realm must be imported from the project directory (directory in the repo: <em>./Keycloak</em>).</p>
<p>Before importing the basic settings, the following adjustments must be made manually in the <em>realm-export.json</em> file:</p>
<table>
<thead>
<tr><th>Name</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td>redirectUris</td><td>Enter host with wildcard (z.B. <a href="https://anwendung.de/*">https://anwendung.de/*</a>)</td></tr>
<tr><td>webOrigins</td><td>Enter allowed Origins (z.B. <a href="https://anwendung.de">https://anwendung.de</a>)</td></tr>
<tr><td>&quot;clientId&quot;: &quot;account&quot; {baseUrl}</td><td>Keycloak URL to Keycloak Account GUI (z.B. /auth/realms/&lt;anwendungs_realm_name&gt;/account)</td></tr>
<tr><td>&quot;clientId&quot;: &quot;account&quot; {redirectUris}</td><td>Keycloak Redirect URIs to Keycloak Account GUI (z.B. /auth/realms/&lt;anwendungs_realm_name&gt;/account)</td></tr>
<tr><td>&quot;clientId&quot;: &quot;security-admin-console&quot; {baseUrl}</td><td>Keycloak URL to Keycloak Admin GUI (z.B. &quot;/auth/admin/&lt;anwendungs_realm_name&gt;/console/index.html&quot;)</td></tr>
<tr><td>&quot;clientId&quot;: &quot;security-admin-console&quot; {redirectUris}</td><td>Keycloak Redirect URIs to Keycloak Admin GUI (z.B. &quot;/auth/admin/&lt;anwendungs_realm_name&gt;/console/index.html&quot;)</td></tr>
<tr><td>&quot;smtpServer&quot;: {port}</td><td>SMTP Server Port</td></tr>
<tr><td>&quot;smtpServer&quot;: {host}</td><td>SMTP Server Host</td></tr>
<tr><td>&quot;smtpServer&quot;: {from}</td><td>SMTP sender address</td></tr>
<tr><td>&quot;smtpServer&quot;: {fromDisplayName}</td><td>SMTP sender name</td></tr>
<tr><td>&quot;smtpServer&quot;: {user}</td><td>SMTP server user</td></tr>
<tr><td>&quot;org.keycloak.storage.UserStorageProvider&quot; : &quot;config&quot; : &quot;usersDn&quot;</td><td>Distinguished names for User (z.B. &quot;ou=users,ou=WebApp,dc=anwendung,dc=de&quot;)</td></tr>
<tr><td>&quot;org.keycloak.storage.UserStorageProvider&quot; : &quot;config&quot; : &quot;bindDn&quot;</td><td>Distinguished names for Admin (z.B. &quot;cn=admin,dc=anwendung,dc=de&quot;)</td></tr>
</tbody>
</table>
<p>To import the JSON file you have to create a new realm in Keycloak.
To do this, open the drop-down menu directly below the Keycloak logo (currently the master realm is selected there) and click on <em>&quot;Add realm&quot;</em>.
In the mask that opens, upload the JSON file.</p>
<h3><a class="anchor" aria-hidden="true" id="ldap"></a><a href="#ldap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LDAP</h3>
<p>Afterwards the connection to LDAP must be updated, because the password is not exported in the realm export.
To do this, go to <em>&quot;User Federation&quot;</em> and select <em>&quot;ldap&quot;</em>. In the configuration fields that open, update the <em>&quot;Bind Credential&quot;</em> field with the password set for the LDAP admin (initial password: admin).
The functionality can be tested with <em>&quot;Test authentication&quot;</em>.
Finally, save the whole thing with the <em>&quot;save&quot;</em> button at the bottom.</p>
<h3><a class="anchor" aria-hidden="true" id="admin-user-for-registrations"></a><a href="#admin-user-for-registrations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Admin user for registrations</h3>
<p>To register new advice seekers in Keycloak, an admin user must be set up through Keycloak's user management. This user needs a name, password and the following role settings:</p>
<ol>
<li>under <em>&quot;Client Roles&quot;</em> → select <em>&quot;realm-management&quot;</em> and under <em>&quot;Assigned Roles&quot;</em> should be the following roles:</li>
</ol>
<ul>
<li>manage-users</li>
<li>view-realm</li>
</ul>
<ol start="2">
<li>under <em>&quot;Client Roles&quot;</em> select → <em>&quot;account&quot;</em> and remove all under <em>&quot;Assigned Roles&quot;</em>.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="technical-user-for-setting-the-master-keys"></a><a href="#technical-user-for-setting-the-master-keys" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Technical user for setting the master keys</h3>
<p>To set the master keys in the services, a technical user must be set up in Keycloak via the
user management. This user needs a name, a password and the following role settings:</p>
<ol>
<li>under <em>&quot;Client Roles&quot;</em>, select → <em>&quot;account&quot;</em> and remove all under <em>&quot;Assigned Roles&quot;</em>.</li>
<li>add the role &quot;technical&quot; to the user.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="password-policies"></a><a href="#password-policies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Password policies</h3>
<p>The same password policies are also implemented in the UserService (UserHelper.java).</p>
<h2><a class="anchor" aria-hidden="true" id="set-up-connections-in-the-nosqlclient"></a><a href="#set-up-connections-in-the-nosqlclient" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Set up connections in the Nosqlclient</h2>
<p>To connect to MongoDB with the Nosqlclient you have to set up the appropriate connections. To do this you have to call the Nosqlclient and select <em>&quot;Connect&quot;</em> in the upper right corner and <em>&quot;Create New&quot;</em> in the following dialog.</p>
<p>The following connection data must be used for the Rocket.Chat DB:</p>
<table>
<thead>
<tr><th>Name</th><th>Host</th><th>Port</th><th>Database name</th><th>Authentication type</th><th>Username</th><th>Passwort</th><th>Authentication DB</th></tr>
</thead>
<tbody>
<tr><td>Rocket.Chat</td><td>mongodb</td><td>27017</td><td>rocketchat</td><td>Scram-Sha-1</td><td>rocketchat*</td><td>rocketchat*</td><td>rocketchat</td></tr>
</tbody>
</table>
<p>* This is the initial password used during the first installation. This password may have to be changed.</p>
<h2><a class="anchor" aria-hidden="true" id="microservices"></a><a href="#microservices" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Microservices</h2>
<p>For all the following microservices, a hosts entry must be made in the <code>docker-compose.yml</code> file. Please replace the <code>&lt;app_domain&gt;</code> and <code>&lt;internal_server_ip_address&gt;</code> placeholders accordingly with your values at the respective <code>extra_hosts</code> property. This ensures that the microservices can make connections to the services on the server.</p>
<h2><a class="anchor" aria-hidden="true" id="agencyservice"></a><a href="#agencyservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AgencyService</h2>
<p>The configuration of the service on the server is done in the AgencyService.env. For local development, the corresponding <em>application-X.properties</em> file must be adapted for this.</p>
<p>The following values must be set:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>SPRING_PROFILES_ACTIVE</td><td><em>local</em> for local development, <em>prod</em> for production system</td></tr>
<tr><td>SPRING_DATASOURCE_URL</td><td>Connection URL: jdbc:mariadb://&lt;host&gt;:&lt;port&gt;/agencyservice</td></tr>
<tr><td>SPRING_DATASOURCE_USERNAME</td><td>Username for AgencyService database user</td></tr>
<tr><td>SPRING_DATASOURCE_PASSWORD</td><td>Password for AgencyService database user</td></tr>
<tr><td>SPRING_LIQUIBASE_USER</td><td>Username for AgencyService liquibase database user</td></tr>
<tr><td>SPRING_LIQUIBASE_PASSWORD</td><td>Password for AgencyService liquibase database user</td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>agency-service</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_CLIENTID</td><td>Keycloak admin client ID</td></tr>
<tr><td>KEYCLOAKSERVICE_APP_CLIENTID</td><td>Keycloak app client ID</td></tr>
<tr><td>USER_ADMIN_SERVICE_API_URL</td><td><a href="http://userservice:8080">http://userservice:8080</a></td></tr>
<tr><td>CONSULTING_TYPE_SERVICE_API_URL</td><td><a href="http://consultingtypeservice:8080">http://consultingtypeservice:8080</a></td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
<tr><td>[CONSULTING_TYPE_NAME]_WHITE_SPOT_AGENCY_ID</td><td>Define the white spot agency IDs where needed for every consulting type</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="mailservice"></a><a href="#mailservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MailService</h2>
<p>The configuration of the service on the server is done in the MailService.env. For local development, the corresponding <em>application-X.properties</em> file must be adapted for this.</p>
<p>The following values must be set:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>APP_IMPRINT_URL</td><td>Imprint URL</td></tr>
<tr><td>APP_DATAPRIVACY_URL</td><td>Data privacy URL</td></tr>
<tr><td>SPRING_PROFILES_ACTIVE</td><td><em>local</em> for local development, <em>prod</em> for production system</td></tr>
<tr><td>SPRING_MAIL_HOST</td><td>SMTP server host</td></tr>
<tr><td>SPRING_MAIL_PORT</td><td>SMTP server port</td></tr>
<tr><td>SPRING_MAIL_USERNAME</td><td>SMTP server username</td></tr>
<tr><td>SPRING_MAIL_PASSWORD</td><td>SMTP server password</td></tr>
<tr><td>MAIL_SENDER</td><td>Mail sender address</td></tr>
<tr><td>MAIL_FIX_RECIPIENT</td><td>For testing: enter e-mail address to which every e-mail is send instead of original recipient</td></tr>
<tr><td>MAIL_ERROR_RECIPIENTS</td><td>e-mail address for mail failures</td></tr>
<tr><td>MAIL_USESMTP</td><td>true for STMP, false for MS Exchange Server</td></tr>
<tr><td>MAIL_EXCHANGE_USER</td><td>MS Exchange Server username</td></tr>
<tr><td>MAIL_EXCHANGE_PASSWORD</td><td>MS Exchange Server password</td></tr>
<tr><td>MAIL_EXCHANGE_URL</td><td>MS Exchange Server URL</td></tr>
<tr><td>MAIL_EXCHANGE_VERSION</td><td>MS Exchange Server version (from enum microsoft.exchange.webservices.data.core.enumeration.misc.ExchangeVersion)</td></tr>
<tr><td>TEMPLATE_USE_CUSTOM_RESOURCES_PATH</td><td>True or False. Decides whether the path specified in TEMPLATE_CUSTOM_RESOURCES_PATH should be taken for the mail templates.</td></tr>
<tr><td>TEMPLATE_CUSTOM_RESOURCES_PATH</td><td>Path to the custom templates</td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="messageservice"></a><a href="#messageservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>MessageService</h2>
<p>The configuration of the service on the server is done in MessageService.env. For local development, the corresponding <em>application-X.properties</em> file must be adapted for this.</p>
<p>The following values must be set:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>APP_BASE_URL</td><td>Application host, e.g. <em><a href="https://anwendung.local">https://anwendung.local</a></em></td></tr>
<tr><td>SPRING_PROFILES_ACTIVE</td><td><em>local</em> for local development, <em>prod</em> for production system</td></tr>
<tr><td>SPRING_DATASOURCE_URL <strong><code>!upcoming with release 2020-11-24</code></strong></td><td>Connection URL: jdbc:mariadb://&lt;host&gt;:&lt;port&gt;/messageservice</td></tr>
<tr><td>SPRING_DATASOURCE_USERNAME <strong><code>!upcoming with release 2020-11-24</code></strong></td><td>Username for MessageService database user</td></tr>
<tr><td>SPRING_DATASOURCE_PASSWORD <strong><code>!upcoming with release 2020-11-24</code></strong></td><td>Password for MessageService database user</td></tr>
<tr><td>SPRING_LIQUIBASE_USER <strong><code>!upcoming with release 2020-11-24</code></strong></td><td>Username for MessageService liquibase database user</td></tr>
<tr><td>SPRING_LIQUIBASE_PASSWORD <strong><code>!upcoming with release 2020-11-24</code></strong></td><td>Password for MessageService liquibase database user</td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: <em>http://&lt;host&gt;/auth</em></td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>agency-service</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_CLIENTID</td><td>Keycloak admin client ID</td></tr>
<tr><td>KEYCLOAKSERVICE_APP_CLIENTID</td><td>Keycloak app client ID</td></tr>
<tr><td>ROCKET_CHAT_API_URL</td><td>Rocket.Chat REST API URL, e.q. <em>http://&lt;host&gt;/api/v1</em></td></tr>
<tr><td>ROCKET_TECHNICAL_USERNAME</td><td>Rocket.Chat technical user username (see <a href="#-create-technical-user">here</a>)</td></tr>
<tr><td>ROCKET_SYSTEMUSER_USERNAME</td><td>Rocket.Chat system user username (see <a href="#-create-system-messages-user">here</a>)</td></tr>
<tr><td>ROCKET_SYSTEMUSER_PASSWORD</td><td>Rocket.Chat system user password</td></tr>
<tr><td>ROCKET_SYSTEMUSER_ID</td><td>Rocket.Chat system user id</td></tr>
<tr><td>USER_SERVICE_API_URL</td><td><a href="http://userservice:8080/users">http://userservice:8080/users</a></td></tr>
<tr><td>USER_SERVICE_API_LIVEPROXY_URL</td><td><a href="http://userservice:8080">http://userservice:8080</a></td></tr>
<tr><td>SERVICE_ENCRYPTION_APPKEY</td><td>Key for message encryption (must match the one defined in the UserService!)</td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="userservice"></a><a href="#userservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UserService</h2>
<p>The configuration of the service on the server is done in the UserService.env. For local development, the corresponding <em>application-X.properties</em> file must be adapted for this. The user ID of the technical Keycloak user can be viewed directly in Keycloak (menu item <em>&quot;Users&quot;</em>).
The Rocket.Chat user ID for the Rocket.Chat system user must be determined directly in MongoDB via the NoSqlClient. To do this, log on to the Rocket.Chat database in the NoSqlClient and execute the following search query on the <em>users</em> collection:</p>
<pre><code class="hljs">{<span class="hljs-attr">"username"</span>:<span class="hljs-string">"&lt;SEARCHED USERNAME&gt;"</span>}
</code></pre>
<p>It is mandatory to set the following values in UserService.env:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>APP_BASE_URL</td><td>Application host, e.g. <em><a href="https://anwendung.local">https://anwendung.local</a></em></td></tr>
<tr><td>CONSULTANT_IMPORT_FILENAME</td><td>Path to consultant import file, e.g. <em>import/consultants.csv</em></td></tr>
<tr><td>CONSULTANT_IMPORT_PROTOCOL_FILENAME</td><td>Path to consultant import log file, e.g. <em>import/consultants-import.txt</em></td></tr>
<tr><td>ASKER_IMPORT_FILENAME</td><td>Path to asker import file, e.g. <em>import/askers.csv</em></td></tr>
<tr><td>ASKER_IMPORT_WITHOUTSESSION_FILENAME</td><td>Path to asker without session import file, e.g. <em>import/askers-without-session.csv</em></td></tr>
<tr><td>ASKER_IMPORT_PROTOCOL_FILENAME</td><td>Path to asker import log file, e.g. <em>import/askers-import.txt</em></td></tr>
<tr><td>ASKER_IMPORT_WELCOME_MESSAGE_FILENAME</td><td>Path to welcome messages (enquiry response), e.g. <em>import/welcome_consulting_type</em>[ConsultingType].txt_</td></tr>
<tr><td>ASKER_IMPORT_WELCOME_MESSAGE_FILENAME_REPLACE_VALUE</td><td>Replacement value for welcome message files, e.g. <em>[ConsultingType]</em></td></tr>
<tr><td>SPRING_PROFILES_ACTIVE</td><td><em>local</em> for local development, <em>prod</em> for production system</td></tr>
<tr><td>SPRING_DATASOURCE_URL</td><td>Connection URL: jdbc:mariadb://&lt;host&gt;:&lt;port&gt;/agencyservice</td></tr>
<tr><td>SPRING_DATASOURCE_USERNAME</td><td>Username for AgencyService database user</td></tr>
<tr><td>SPRING_DATASOURCE_PASSWORD</td><td>Password for AgencyService database user</td></tr>
<tr><td>SPRING_LIQUIBASE_USER</td><td>Username for AgencyService liquibase database user</td></tr>
<tr><td>SPRING_LIQUIBASE_PASSWORD</td><td>Password for AgencyService liquibase database user</td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>agency-service</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_CLIENTID</td><td>Keycloak admin client ID</td></tr>
<tr><td>KEYCLOAKSERVICE_APP_CLIENTID</td><td>Keycloak app client ID</td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_USERNAME</td><td>Keycloak admin user username (see <a href="#-admin-benutzer-für-registrierungen">here</a>)</td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_PASSWORD</td><td>Keycloak admin user password</td></tr>
<tr><td>KEYCLOAKSERVICE_TECHNICAL_USERNAME</td><td>Keycloak technical user username (see <a href="#-technischer-benutzer-zum-setzen-der-masterkeys">here</a>)</td></tr>
<tr><td>KEYCLOAKSERVICE_TECHNICAL_PASSWORD</td><td>Keycloak technical user password</td></tr>
<tr><td>ROCKET_CHAT_API_URL</td><td>Rocket.Chat REST API URL, e.q. <em>http://&lt;host&gt;/api/v1</em></td></tr>
<tr><td>ROCKET_TECHNICAL_USERNAME</td><td>Rocket.Chat technical user username (see <a href="#-create-technical-user">here</a>)</td></tr>
<tr><td>ROCKET_TECHNICAL_PASSWORD</td><td>Rocket.Chat technical user password</td></tr>
<tr><td>ROCKET_SYSTEMUSER_USERNAME</td><td>Rocket.Chat system user username (see <a href="#-create-system-messages-user">here</a>)</td></tr>
<tr><td>ROCKET_SYSTEMUSER_PASSWORD</td><td>Rocket.Chat system user password</td></tr>
<tr><td>ROCKET_SYSTEMUSER_ID</td><td>Rocket.Chat system user ID</td></tr>
<tr><td>AGENCY_SERVICE_API_URL</td><td><a href="http://agencyservice:8080/agencies">http://agencyservice:8080/agencies</a></td></tr>
<tr><td>MESSAGE_SERVICE_API_URL</td><td><a href="http://messageservice:8080">http://messageservice:8080</a></td></tr>
<tr><td>MAIL_SERVICE_API_URL</td><td><a href="http://mailservice:8080">http://mailservice:8080</a></td></tr>
<tr><td>LIVE_SERVICE_API_URL</td><td><a href="http://liveservice:8080">http://liveservice:8080</a></td></tr>
<tr><td>CONSULTING_TYPE_SERVICE_API_URL</td><td><a href="http://consultingtypeservice:8080">http://consultingtypeservice:8080</a></td></tr>
<tr><td>SERVICE_ENCRYPTION_APPKEY</td><td>Key for message encryption (must match the one defined in the UserService!)</td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
<tr><td>TWOFACTORAUTH_USER_ENABLED</td><td>Determines whether the two-factor authentication can be activated for the users (true or false)</td></tr>
<tr><td>TWOFACTORAUTH_CONSULTANT_ENABLED</td><td>Determines whether the two-factor authentication can be activated for the consultants (true or false)</td></tr>
<tr><td>KEYCLOAKAPI_URL_OTP</td><td>Path to the two factor authentication keycloak extension</td></tr>
<tr><td>KEYCLOAKAPI_OTP_SETUP_INFO</td><td>Endpoint to get the setup data for the two factor authentication</td></tr>
<tr><td>KEYCLOAKAPI_OTP_SETUP</td><td>Endpoint to activate the two factor authentication</td></tr>
<tr><td>KEYCLOAKAPI_OTP_DELETE</td><td>Endpoint to deactivate two factor authentication</td></tr>
</tbody>
</table>
<p>⚠️ Before the first start of the UserService it is mandatory to set <code>SPRING_ACTIVE_PROFILE</code> to <code>dev</code>. This guarants that the database structure is created correctly. After the first start the value can be changed back to <code>prod</code>. ⚠️</p>
<h3><a class="anchor" aria-hidden="true" id="delete-workflows"></a><a href="#delete-workflows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete workflows</h3>
<p>Within the application the user has the possibility to delete the own account. You can configure additional and automatic delete workflows for data privacy reasons. You find the configuration details <a href="/documentation/docs/backend/delete-workflows">here</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="uploadservice"></a><a href="#uploadservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UploadService</h2>
<p>The configuration of the service on the server is done in the UploadService.env. For local development, the corresponding <em>application-X.properties</em> file must be adapted for this.</p>
<p>The following values must be set in the UploadService.env:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>APP_BASE_URL</td><td>Application host, e.g. <em><a href="https://anwendung.local">https://anwendung.local</a></em></td></tr>
<tr><td>SPRING_PROFILES_ACTIVE</td><td><em>local</em> for local development, <em>prod</em> for production system</td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>KEYCLOAKSERVICE_ADMIN_CLIENTID</td><td>Keycloak admin client ID</td></tr>
<tr><td>KEYCLOAKSERVICE_APP_CLIENTID</td><td>Keycloak app client ID</td></tr>
<tr><td>ROCKET_CHAT_API_URL</td><td>Rocket.Chat REST API URL, e.q. <em>http://&lt;host&gt;/api/v1</em></td></tr>
<tr><td>ROCKET_SYSTEMUSER_USERNAME</td><td>Rocket.Chat system user username (see <a href="#-create-system-messages-user">here</a>)</td></tr>
<tr><td>ROCKET_SYSTEMUSER_PASSWORD</td><td>Rocket.Chat system user password</td></tr>
<tr><td>USER_SERVICE_API_URL</td><td><a href="http://userservice:8080/users">http://userservice:8080/users</a></td></tr>
<tr><td>USER_SERVICE_API_LIVEPROXY_URL</td><td><a href="http://userservice:8080">http://userservice:8080</a></td></tr>
<tr><td>SERVICE_ENCRYPTION_APPKEY</td><td>Key for message encryption (must match the one defined in the UserService!)</td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="liveservice"></a><a href="#liveservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LiveService</h2>
<p>The configuration of the service on the server is done in the LiveService.env file.
development, the application.properties file must be adapted.</p>
<p>The following values must be set in the UploadService.env:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>SPRING_MAIN_ALLOW-BEAN-DEFINITION-OVERRIDING=true</td><td>Needed for using keycloak security session bean</td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>Keycloak resource name</td></tr>
<tr><td>APP_BASE_URL</td><td>Client base URL used for cors restriction: http://&lt;host&gt;</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="videoservice"></a><a href="#videoservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>VideoService</h2>
<p>The configuration on the server is located in the <code>VideoService.env</code> file. To configure the service for local development you can configure the corresponding <code>application-X.properties</code> file.</p>
<p>Following values are mandatory:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>APP_BASE_URL</td><td>Application host, e.g. <em><a href="https://application.local">https://application.local</a></em></td></tr>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>Keycloak resource name</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>VIDEO_CALL_SERVER_URL</td><td>Root path to the (Jitsi) VideoBackend instance</td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
<tr><td>VIDEO_CALL_SECURITY_JWT_AUDIENCE</td><td>Audience property (must match one of the JWT_ACCEPTED_AUDIENCES configured in (Jitsi) VideoBackend instance!)</td></tr>
<tr><td>VIDEO_CALL_SECURITY_JWT_ISSUER</td><td>Issuer property (must match one of the JWT_ACCEPTED_ISSUERS configured in (Jitsi) VideoBackend instance!)</td></tr>
<tr><td>VIDEO_CALL_SECURITY_JWT_SUBJECT</td><td>Subject property to be used in JWT token</td></tr>
<tr><td>VIDEO_CALL_SECURITY_JWT_SECRET</td><td>Secret property (must match the JWT_APP_SECRET configured in (Jitsi) VideoBackend instance!)</td></tr>
<tr><td>VIDEO_CALL_SECURITY_JWT_VALIDITY_HOURS</td><td>Validity time of the token in hours</td></tr>
</tbody>
</table>
<p>The properties <code>USER_SERVICE_API_URL</code>, <code>LIVE_SERVICE_API_URL</code> and <code>MESSAGE_SERVICE_API_URL</code> should point to the corresponding service (docker internal) and should only be changed if necessary.</p>
<h2><a class="anchor" aria-hidden="true" id="consultingtypeservice"></a><a href="#consultingtypeservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ConsultingTypeService</h2>
<p>The configuration on the server is located in the <code>ConsultingTypeService.env</code> file. To configure the service for local development you can configure the corresponding <code>application-X.properties</code> file.</p>
<p>Following values are mandatory:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
</tbody>
</table>
<p>Following values are optional:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>consulting.types.json.path</td><td>The relative path to the directory on the host system to the consulting type settings files (default: consulting-type-settings)</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="statisticsservice"></a><a href="#statisticsservice" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>StatisticsService</h2>
<p>The configuration on the server is located in the <code>StatisticsService.env</code> file. To configure the service for local development you can configure the corresponding <code>application-X.properties</code> file.</p>
<p>Before you start create a new user for the RabbitMQ connections from the services in the management console or via shell set read and write permissions:</p>
<p><strong>Virtual host permissions</strong></p>
<table>
<thead>
<tr><th>Virtual host</th><th>Configure regexp</th><th>Write regexp</th><th>Read regexp</th></tr>
</thead>
<tbody>
<tr><td>/</td><td>.*</td><td>.*</td><td>.*</td><td>.*</td></tr>
</tbody>
</table>
<p><strong>Topic permissions</strong></p>
<table>
<thead>
<tr><th>Virtual host</th><th>Exchange</th><th>write regexp</th><th>Read regexp</th></tr>
</thead>
<tbody>
<tr><td>/</td><td>statistics.exchange</td><td>.*</td><td>.*</td></tr>
</tbody>
</table>
<p>⚠️ Important: The topic permission can only be set after the StatisticsService has been started for the first time. ⚠️
⚠️ Important: The user must have the tag <code>administrator</code>. This is necessary, because the RabbitMQ API is only accessible with this tag (need for VideoBackend). ⚠️</p>
<p>Following values are mandatory:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>KEYCLOAK_AUTH_SERVER_URL</td><td>Keycloak authentication server URL: http://&lt;host&gt;/auth</td></tr>
<tr><td>KEYCLOAK_REALM</td><td>Keycloak realm name</td></tr>
<tr><td>KEYCLOAK_PRINCIPAL-ATTRIBUTE</td><td>Keycloak principal attribute: preferred_username</td></tr>
<tr><td>KEYCLOAK_RESOURCE</td><td>Keycloak resource name</td></tr>
<tr><td>KEYCLOAK_CORS</td><td>false for production system! Further information about <a href="/documentation/docs/backend/cors-configuration">CORS</a></td></tr>
<tr><td>CSRF_HEADER_PROPERTY</td><td>CSRF header property name (must match the frontend header name!)</td></tr>
<tr><td>CSRF_COOKIE_PROPERTY</td><td>CSRF cookie property name (must match the frontend cookie name!)</td></tr>
<tr><td>SPRING_RABBITMQ_USERNAME</td><td>The RabbitMQ username for the connection</td></tr>
<tr><td>SPRING_RABBITMQ_PASSWORD</td><td>The RabbitMQ password for the connection</td></tr>
<tr><td>SPRING_DATA_MONGODB_URI</td><td>The connection uri for the MongoDD, e.g. mongodb://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@mongodb:27017/statistics?retryWrites=false</td></tr>
</tbody>
</table>
<p>You can also customize the following RabbitMQ settings if desired:</p>
<table>
<thead>
<tr><th>Name</th><th>Description</th><th>Default</th></tr>
</thead>
<tbody>
<tr><td>SPRING_RABBITMQ_LISTENER_SIMPLE_RETRY_ENABLED</td><td>Enable/Disabling automatic retries for message process failures</td><td>true</td></tr>
<tr><td>SPRING.RABBITMQ_LISTENER_SIMPLE_RETRY_MAX-ATTEMPTS</td><td>The processing should be retried maximum of n times after that it will be sent to dead letter Queue.</td><td>3</td></tr>
<tr><td>SPRING.RABBITMQ_LISTENER_SIMPLE_RETRY_INITIAL-INTERVAL</td><td>The processing should be retried after an interval of n ms.</td><td>2000</td></tr>
<tr><td>SPRING.RABBITMQ_LISTENER_SIMPLE_RETRY_MAX-INTERVAL</td><td>The maximum time interval between two retries. It should never exceed 10s.</td><td>10000</td></tr>
<tr><td>SPRING.RABBITMQ_LISTENER_SIMPLE_RETRY_MULTIPLIER</td><td>The interval between second retry gets multiplied by this multiplier. But this interval can never exceed the max-interval.</td><td>2</td></tr>
</tbody>
</table>
<p>During the first start of the service the required exhanges and queues will be applied in RabbitMQ.</p>
<h3><a class="anchor" aria-hidden="true" id="definition-of-the-consulting-type-settings"></a><a href="#definition-of-the-consulting-type-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Definition of the consulting type settings</h3>
<p>You need to define the settings of all your consulting types in single json files and put them into the directory specified in the property <code>consulting.types.json.path</code>:</p>
<ul>
<li><a href="https://github.com/CaritasDeutschland/documentation/blob/master/docs/backend/admin/consultingtypeservice/schemas/consulting-type.md">Consulting type schema</a></li>
<li><a href="https://github.com/CaritasDeutschland/documentation/blob/master/docs/backend/admin/consultingtypeservice/schemas/consulting-type.json">Consulting type schema json file</a></li>
<li><a href="https://github.com/CaritasDeutschland/caritas-onlineBeratung-consultingTypeService/tree/master/consulting-type-settings">Example consulting type settings json files</a></li>
</ul>
<p><strong>Please be aware that the properties id and slug have to be unique.</strong></p>
<p><strong>If the ConsultingTypeService does not start, please check the log file for indications of configuration errors.</strong></p>
<p>⚠️ Please keep in mind that after making changes to the consulting type settings you need to restart Agency- and UserService (settings are being cached)! ⚠️</p>
<h2><a class="anchor" aria-hidden="true" id="elk-services"></a><a href="#elk-services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ELK Services</h2>
<p>The services Elasticsearch, Logstash, and Kibana are also called <a href="https://www.elastic.co/what-is/elk-stack">ELK Stack</a>.
They form the centralized logging inside the microservice architecture that can aggregate logs from each service
instance. Developers can search and analyze the logs.</p>
<p>The stack is pre-configured with the privileged bootstrap user <em>elastic</em> (password: <em>changeme</em>.) Please increase
security by using the unprivileged
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/built-in-users.html">built-in users</a> instead:</p>
<ol>
<li><p>Initialize passwords for built-in users</p>
<pre><code class="hljs css language-console"><span class="hljs-meta">$</span><span class="bash"> docker-compose <span class="hljs-built_in">exec</span> -T elasticsearch bin/elasticsearch-setup-passwords auto --batch</span>
</code></pre>
<p>Passwords for all 6 built-in users will be randomly generated. Take note of them.</p></li>
<li><p>Replace usernames and passwords in configuration files</p>
<p>Use the <code>kibana_system</code> user inside the Kibana configuration file (<code>kibana/config/kibana.yml</code>) and the
<code>logstash_system</code> user inside the Logstash configuration file (<code>logstash/config/logstash.yml</code>) in place of the
existing <code>elastic</code> user. Replace the password for the <code>elastic</code> user inside the Logstash pipeline file
(<code>logstash/pipeline/logstash.conf</code>). Do NOT use the <code>logstash_system</code> user inside the Logstash pipeline file, it does
not have sufficient permissions to create indices.</p></li>
</ol>
<p>After restart in the following section, you should be able to visit http://<em>host</em>:3004 and log in with the <em>elastic</em>
user and the new password.</p>
<h2><a class="anchor" aria-hidden="true" id="optional-configure-2-factor-authentication-via-otp"></a><a href="#optional-configure-2-factor-authentication-via-otp" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>(Optional) Configure 2 factor authentication via OTP</h2>
<ol>
<li>Build a jar file with maven install of the repository <a href="https://github.com/CaritasDeutschland/caritas-onlineberatung-keycloak-otp">https://github.com/CaritasDeutschland/caritas-onlineberatung-keycloak-otp</a></li>
<li>Add the generated .jar file to the folder ./Keycloak of your environment</li>
<li>Add a volume mapping for the keycloak service in your <code>docker-compose.yaml</code> e.g.
<code>- ./Keycloak/keycloak-otp-config-spi-1.0-SNAPSHOT-keycloak.jar:/opt/jboss/keycloak/standalone/deployments/keycloak-otp-config-spi-1.0-SNAPSHOT-keycloak.jar</code></li>
<li>Restart the keycloak compose service with <code>docker-compose up -d --no-deps keycloak</code></li>
<li>Go to the administration console of keycloak to <code>Authentication</code> -&gt; <code>Flows</code> and copy the existing Flow named <code>Direct Grant</code></li>
<li>Under <code>Direct Grant - Direct-grant-validate-otp - Conditional</code> click the actions dropdown and add a execution</li>
<li>Select the <code>OTP Parameter Validator</code> and click on save to finally add the execution to your flow</li>
<li>Change the order of the added execution so hat it´s directly located above <code>OTP</code></li>
<li>Under the tab <code>Bindings</code> set your new flow for <code>Direct Grant Flow</code></li>
<li>Ensure your admin user configured in <code>UserService.env</code> for keycloak has the role <code>technical</code> assigned</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="restart-of-all-services"></a><a href="#restart-of-all-services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Restart of all services</h2>
<p>After changes have been made, all services should be restarted again by <em>docker-compose restart</em>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/documentation/docs/backend/first-start"><span class="arrow-prev">← </span><span>First start</span></a><a class="docs-next button" href="/documentation/docs/backend/file-permissions"><span>File permissions</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#rocketchat">Rocket.Chat</a><ul class="toc-headings"><li><a href="#configure-ldap">Configure LDAP:</a></li><li><a href="#create-technical-user">Create technical user</a></li><li><a href="#create-system-messages-user">Create system messages user</a></li><li><a href="#delete-bot-user">Delete Bot-User</a></li><li><a href="#configure-read-status">Configure read status</a></li><li><a href="#configure-file-upload">Configure file upload</a></li><li><a href="#rate-limiter">Rate Limiter</a></li><li><a href="#general">General</a></li><li><a href="#accounts">Accounts</a></li></ul></li><li><a href="#keycloak">Keycloak</a><ul class="toc-headings"><li><a href="#realm">Realm</a></li><li><a href="#ldap">LDAP</a></li><li><a href="#admin-user-for-registrations">Admin user for registrations</a></li><li><a href="#technical-user-for-setting-the-master-keys">Technical user for setting the master keys</a></li><li><a href="#password-policies">Password policies</a></li></ul></li><li><a href="#set-up-connections-in-the-nosqlclient">Set up connections in the Nosqlclient</a></li><li><a href="#microservices">Microservices</a></li><li><a href="#agencyservice">AgencyService</a></li><li><a href="#mailservice">MailService</a></li><li><a href="#messageservice">MessageService</a></li><li><a href="#userservice">UserService</a><ul class="toc-headings"><li><a href="#delete-workflows">Delete workflows</a></li></ul></li><li><a href="#uploadservice">UploadService</a></li><li><a href="#liveservice">LiveService</a></li><li><a href="#videoservice">VideoService</a></li><li><a href="#consultingtypeservice">ConsultingTypeService</a></li><li><a href="#statisticsservice">StatisticsService</a><ul class="toc-headings"><li><a href="#definition-of-the-consulting-type-settings">Definition of the consulting type settings</a></li></ul></li><li><a href="#elk-services">ELK Services</a></li><li><a href="#optional-configure-2-factor-authentication-via-otp">(Optional) Configure 2 factor authentication via OTP</a></li><li><a href="#restart-of-all-services">Restart of all services</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/documentation/" class="nav-home"><img src="/documentation/img/caritas_logo.svg" alt="Caritas Online-Beratung" width="66" height="58"/></a><div><h5>Docs</h5><a href="/documentation/docs/general/home.html">Home</a><a href="/documentation/docs/setup/setup-backend.html">Setting up Backend</a><a href="/documentation/docs/setup/setup-frontend.html">Setting up Frontend</a></div><div><h5>More</h5><a href="https://github.com/CaritasDeutschland">GitHub</a></div></section><section class="copyright">Copyright © 2022 Caritas Deutschland</section></footer></div></body></html>